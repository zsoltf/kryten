#!/usr/bin/env ruby

require "bundler/setup"
require "kryten"
require "pry"

include Kryten

class Work
  include Runner
  include Daemon
  def log message
    puts "#{Process.pid} "+name + ': ' + message
  end
  def run
    work = rand(5)+1;
    log "working for #{work}"
    sleep work
    log "done working"
  end
end

workers = []
workers << Work.new('work1')
workers << Work.new('work2')
w3 = Work.new('work3').workers do
  [Work.new('work3sub1'),
   Work.new('work3sub2')]
end
workers << w3

=begin
Daemons.run_proc('kryten') do
  Supervisor.start(workers)
end
=end

#binding.pry

Supervisor.start(workers)
